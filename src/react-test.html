<!doctype html>
<html>
  <head>
    <title>Embedabble</title>
    <meta charset="utf-8" />
    <script
      type="module"
      src="https://api.embeddable.com/js/v1/"></script>
    <script 
      src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script 
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>
  <body>
    <div id='test-container'></div>

    <script type="text/babel">
      'use strict';

      function Embeddable({onComponentsLoad, ...props}) {
        const ref = React.useRef(null);

        React.useEffect(() => {
          ref.current.addEventListener('componentsLoad', onComponentsLoad);
          return () => {
            ref.current.removeEventListener('componentsLoad', onComponentsLoad);
          };
        }, []);
        return React.createElement('em-beddable', {...props, ref});
      }

      const TestComponent = () => {
        const [load, setLoad] = React.useState(false);
        const [isLoading, setIsLoading] = React.useState(false);

          if (load) {
            return (
              <div>
                {isLoading && <div>Loading dashboard...</div>}
                <Embeddable
                  token="eyJhbGciOiJIUzI1NiJ9.eyJzZWN1cml0eVRva2VuSWQiOiJlNWQ2ZWFmZS0yMDMzLTRkYjgtYTdiYy1mYTAyOTkzYjczZGQiLCJpYXQiOjE3MDg1OTA5MDgsImV4cCI6MTcwOTE5NTcwOH0.ccj1bNbT3KOmYCu7Oi7JWT7Yea1vo0Q5xN30mvA9i64"
                  onComponentsLoad={() =>  setIsLoading(false)}
                />
              </div>
            );
          }

          return (
            <button onClick={() => {
              setIsLoading(true);
              setLoad(true);
            }}>
              Load my dashboard
            </button>
          );
      }

      const domContainer = document.querySelector('#test-container');
      const root = ReactDOM.createRoot(domContainer);
      root.render(React.createElement(TestComponent));
    </script>
  </body>
</html>
